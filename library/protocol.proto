syntax = "proto2";

// MSG_FORWARD_REMOTE
message ForwardRemote
{
  required fixed32 magic         = 1; // FORWARD_REMOTE_MAGIC
  required uint32  protocolMajor = 2; // Protocol version
  required uint32  protocolMinor = 3;
  required bytes   tunnelId      = 4; // Tunnel ID from MSG_REMOTE_REPLY
  required string  signature     = 5; // "Mdg-NaCl/binary"
}

// MSG_PROTOCOL_VERSION
message Property
{
  required string key   = 1;
  required string value = 2;
}

message ProtocolVersion
{
  required fixed32  magic      = 1;
  required uint32   major      = 2;
  required uint32   minor      = 3;
  repeated Property properties = 4;
}

// MSG_FORWARD_REPLY
message ForwardReply
{
  required string signature = 1;
}

// MSG_CALL_REMOTE
message ConnectToPeer
{
  required uint32 id       = 1;
  required string peerId   = 2;
  required string protocol = 3;
}

// MSG_REMOTE_REPLY
message PeerReply
{
  required uint32 id     = 1;
  required uint32 result = 2;
  message PeerInfo
  {
    required string peerId = 3;
    message ForwardHost
    {
      required string host = 1;
      required uint32 port = 2;
    }
    required ForwardHost server   = 4;
    required bytes       tunnelId = 5;
  }
  optional PeerInfo peer = 3;
}

